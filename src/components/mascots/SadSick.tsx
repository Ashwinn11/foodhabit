import React, { useEffect } from 'react';
import { ViewStyle } from 'react-native';
import Svg, { Path, G, Ellipse, Circle } from 'react-native-svg';
import Animated, { 
  useSharedValue, 
  useAnimatedProps, 
  withSequence, 
  withTiming 
} from 'react-native-reanimated';
import MascotWrapper from './MascotWrapper';

const AnimatedG = Animated.createAnimatedComponent(G);

interface MascotProps {
  size?: number;
  style?: ViewStyle;
  animated?: boolean;
}

export default function SadSick({ size = 160, style, animated = true }: MascotProps) {
  // SVG will render at 85% of the container size for consistent visual appearance
  const svgSize = size * 0.85;
  const eyeScale = useSharedValue(1);

  useEffect(() => {
    if (!animated) return;

    let timeout: NodeJS.Timeout;

    const blink = () => {
      eyeScale.value = withSequence(
        withTiming(0.1, { duration: 100 }),
        withTiming(1, { duration: 100 })
      );
      
      const nextBlink = Math.random() * 3000 + 2000;
      timeout = setTimeout(blink, nextBlink);
    };

    // Initial delay
    timeout = setTimeout(blink, 2000);

    return () => clearTimeout(timeout);
  }, [animated]);

  const leftEyeAnimatedProps = useAnimatedProps(() => ({
    transform: [
      { translateX: 123.71 },
      { translateY: 171.18 },
      { scaleY: eyeScale.value },
      { translateX: -123.71 },
      { translateY: -171.18 },
    ]
  }));

  const rightEyeAnimatedProps = useAnimatedProps(() => ({
    transform: [
      { translateX: 231.21 },
      { translateY: 171.19 },
      { scaleY: eyeScale.value },
      { translateX: -231.21 },
      { translateY: -171.19 },
    ]
  }));

  return (
    <MascotWrapper size={size} style={style}>
      <Svg viewBox="0 0 383.62 412.16" width={svgSize} height={svgSize}>
        <G>
          {/* Right Leg */}
          <G>
            <Path 
              d="M210.29,407.08c-1.08,0-2.05-.75-2.3-1.84-4.9-22.06,0-49.57.21-50.74.23-1.28,1.45-2.12,2.74-1.9,1.28.23,2.13,1.46,1.9,2.74-.05.27-4.94,27.76-.25,48.87.28,1.27-.52,2.53-1.79,2.81-.17.04-.34.06-.51.06Z" 
              fill="#ff3b5c"
            />
            <Path 
              d="M208.1,403.98s8.9-6.12,20.02-5.56c11.12.56,13.35,11.12,12.23,12.79-1.11,1.67-25.9.78-30.58,0-3.34-.56-1.67-7.23-1.67-7.23Z" 
              fill="#ff3b5c"
            />
          </G>
          
          {/* Left Leg */}
          <G>
            <Path 
              d="M138.88,407.08c-.17,0-.34-.02-.51-.06-1.27-.28-2.07-1.54-1.79-2.81,4.7-21.14-.2-48.6-.25-48.87-.23-1.28.62-2.5,1.89-2.74,1.29-.23,2.5.62,2.74,1.89.21,1.16,5.11,28.68.21,50.74-.24,1.1-1.22,1.84-2.29,1.84Z" 
              fill="#ff3b5c"
            />
            <Path 
              d="M141.07,403.98s-8.9-6.12-20.02-5.56c-11.12.56-13.35,11.12-12.23,12.79-1.11,1.67-25.9.78,30.58,0,3.34-.56-1.67-7.23-1.67-7.23Z" 
              fill="#ff3b5c"
            />
          </G>
          
          {/* Right Arm */}
          <Path 
            d="M286.27,83.94s40.21-33.34,27.78-53.93c-9.06-15.01-25.83-14.1-31.43-6.75-7.19,9.43-16.06,22.24-25.91,30.12l29.57,30.55Z" 
            fill="#a3a33a"
          />
          <G>
            <Path 
              d="M295.74,37.87c5.6,4.04,12.53,5.02,14.61,2.15,2.07-2.87-.67-9.03-6.27-13.07s-11.93-4.44-14-1.57c-2.08,2.87.07,8.45,5.67,12.49Z" 
              fill="#848125"
            />
            <Path 
              d="M295.74,37.87c5.6,4.04,12.79,5.19,14.61,2.15,1.14-1.9-4.19.11-11.96-5.4-7-4.97-7.34-10.39-8.32-9.23-2.29,2.71.07,8.45,5.67,12.49Z" 
              fill="#ff3b5c"
            />
          </G>
          <Path 
            d="M286.09,87.14l-32.88-33.98,2.02-1.62c8.1-6.48,15.52-16.39,22.06-25.13,1.19-1.59,2.34-3.13,3.45-4.59,3.1-4.07,8.88-6.39,15.08-6.05,8.13.44,15.51,5.18,20.24,13.01,13.33,22.07-26.58,55.54-28.29,56.95l-1.68,1.39ZM260.15,53.57l26.26,27.14c7.25-6.43,35.5-33.1,25.62-49.47-3.91-6.47-9.91-10.39-16.46-10.74-4.59-.25-8.95,1.4-11.08,4.2h0c-1.10,1.45-2.25,2.98-3.43,4.56-6.19,8.27-13.14,17.55-20.9,24.32Z" 
            fill="#ff3b5c"
          />
          
          {/* Body */}
          <Path 
            d="M180.35,19.31c91.19,1.05,147.01,92.42,134.15,195.34-2.2,17.62-4.36,27.23-6.97,42.41-1.03,5.98-2.82,19.35,11.36,30.57,18.72,14.82,29.22,24.42,30.78,42.36,1.56,17.94-10.61,38.11-13.06,42.38-1.41,2.46-8.54,10.9-23.33,4.36-16.77-7.41-13.47-17.64-12.33-20.1,2.08-4.5,7.7-11.31,3.6-19.5-4.98-9.95-18.91-23.52-53.28-.81-25.21,16.66-55.59,24.69-81.55,24.69-64.13,0-116.47-51.04-127.06-154.6C33.2,113.81,77.97,18.13,180.35,19.31Z" 
            fill="#a3a33a"
          />
          <Path 
            d="M180.35,19.31c91.19,1.05,147.01,92.42,134.15,195.34-2.2,17.62-4.36,27.23-6.97,42.41-1.03,5.98-2.82,19.35,11.36,30.57,18.72,14.82,29.22,24.42,30.78,42.36,1.10,12.61-4.59,26.31-8.91,34.83-1.37-4.19-5.5-8.13-14.45-11.81-16.25-6.70-5.49-16.92-12.44-31.49-7.14-14.99-34.32-23.84-54.26-13.49-26.82,13.93-55.59,24.69-81.55,24.69-64.13,0-120.61-40.36-131.20-143.92-2.44-23.9-1.26-48,3.58-70.59C70.03,67.01,115.81,18.57,180.35,19.31Z" 
            fill="#bfc458"
          />
          
          {/* Right Hand Detail */}
          <G>
            <Path 
              d="M322.37,357.71c-7.2-3.21-15.18-2.68-16.83,1.01s2.86,9.93,10.07,13.14,14.37,2.18,16.02-1.52c1.65-3.7-2.06-9.42-9.26-12.63Z" 
              fill="#848125"
            />
            <Path 
              d="M322.37,357.71c-7.2-3.21-15.51-2.81-16.83,1.01-.83,2.39,4.66-1.11,14.63,3.24,8.99,3.92,10.63,9.90,11.45,8.38,1.92-3.56-2.06-9.42-9.26-12.63Z" 
              fill="#ff3b5c"
            />
          </G>
          
          {/* Body Outline */}
          <Path 
            d="M323.52,381.48c-3.25,0-6.98-.74-11.19-2.6-7.30-3.23-11.96-7.40-13.85-12.40-2.64-7,1.15-12.46,1.79-13.61,2.34-4.25,5-9.06,2.18-14.69-2.02-4.05-5.92-9.27-12.99-11.16-9.37-2.51-21.78,1.28-36.89,11.26-24.12,15.94-54.32,25.08-82.85,25.08-33.44,0-62.97-13.58-85.38-39.27-23.72-27.19-38.94-67.80-44.02-117.44-5.95-58.19,9.56-113.81,41.50-148.78,24.87-27.22,58.91-41.35,98.54-40.91,37.66.43,70.85,15.88,95.97,44.67,33.16,38,47.91,93.88,40.48,153.31-1.58,12.63-3.16,21.32-4.84,30.52-.68,3.75-1.39,7.65-2.14,12-.83,4.82-3.03,17.62,10.50,28.33,18.60,14.73,30.02,25.04,31.67,44.01,1.04,11.91-3.34,26.42-13.02,43.15-.25.44-4.41,8.54-15.48,8.54ZM283.57,321.57c2.5,0,4.88.3,7.12.9,8.76,2.34,13.53,8.69,15.98,13.60,3.92,7.84.19,14.60-2.27,19.07-.85,1.54-3.26,5.05-1.51,9.68,1.43,3.78,5.25,7.06,11.35,9.76,14.90,6.59,20.30-3.32,20.69-3.99,9.18-15.88,13.35-29.46,12.40-40.39-1.43-16.50-10.66-25.49-29.90-40.72-15.72-12.44-13.08-27.78-12.22-32.82.75-4.37,1.46-8.28,2.15-12.04,1.66-9.14,3.24-17.76,4.80-30.26,7.16-57.25-7.56-113.19-39.36-149.64-24.22-27.75-56.20-42.64-92.48-43.06-.60,0-1.19-.01-1.79-.01-37.46,0-69.66,13.60-93.22,39.39-31.05,33.99-46.12,88.25-40.30,145.13,9.77,95.48,56.39,152.48,124.72,152.48,27.63,0,56.88-8.86,80.25-24.30,12.87-8.50,24.12-12.78,33.57-12.78Z" 
            fill="#ff3b5c"
          />
          
          {/* Cheek Highlight */}
          <Path 
            d="M127.87,55.66c-15.64-15.64-65.34,42.90-50.09,58.16,15.26,15.26,65.61-42.64,50.09-58.16Z" 
            fill="#e5e56a"
          />
          
          {/* Eyes - Yellow/Green */}
          <Ellipse cx="235.47" cy="208.6" rx="16.68" ry="12.87" fill="#e5e56a" />
          <Ellipse cx="122.23" cy="208.6" rx="16.68" ry="12.87" fill="#e5e56a" />
          
          {/* Left Mouth Corner */}
          <Path 
            d="M85.02,282.19c-24.03,0-40.14-6.29-47.91-18.73-13.24-21.19,2.81-51.88,3.50-53.18.61-1.15,2.04-1.58,3.18-.97,1.15.61,1.58,2.03.97,3.18-.15.29-15.47,29.61-3.66,48.49,7.37,11.78,23.82,17.32,48.94,16.42,1.28-.06,2.39.97,2.43,2.27.05,1.30-.97,2.39-2.27,2.43-1.77.06-3.51.09-5.20.09Z" 
            fill="#ff3b5c"
          />
          
          {/* Center Mouth - Sad Expression */}
          <Path 
            d="M197.75,213.53c-1.11,0-2.09-.79-2.31-1.91-.11-.58-3.02-14.44-18.13-14.44s-17.42,13.50-17.49,14.07c-.15,1.29-1.30,2.22-2.60,2.07-1.29-.15-2.21-1.30-2.07-2.59.02-.18,2.24-18.25,22.17-18.25s22.72,18.08,22.75,18.27c.24,1.28-.59,2.51-1.87,2.75-.15.03-.30.04-.44.04Z" 
            fill="#ff3b5c"
          />
          
          {/* Left Mouth Detail */}
          <Path 
            d="M84.2,278.82s15.73-6.69,22.61-3.2c6.88,3.48-.08,18.80-6.05,18.95-5.96.15-17.51-12.6-17.51-12.6l.95-3.14Z" 
            fill="#ff3b5c"
          />
          
          {/* Right Mouth Corner */}
          <Path 
            d="M316.42,210.28c.69,1.30,16.75,31.99,3.51,53.18-7.77,12.44-23.88,18.73-47.91,18.73-1.69,0-3.43-.03-5.20-.09-1.30-.05-2.32-1.14-2.27-2.43s1.13-2.32,2.43-2.27c25.11.90,41.58-4.64,48.94-16.42,10.15-16.23.25-40.18-2.82-46.76l3.31-3.94Z" 
            fill="#ff3b5c"
          />
          
          {/* Right Mouth Detail */}
          <Path 
            d="M272.84,278.82s-15.73-6.69-22.61-3.20.08,18.80,6.05,18.95c5.96.15,17.51-12.6,17.51-12.6l-.95-3.14Z" 
            fill="#ff3b5c"
          />
          
          {/* Decorative Element - Left Top */}
          <Path 
            d="M60.09,69.66c-.51,0-1.02-.16-1.45-.50L14.13,34.28c-1.02-.80-1.20-2.28-.40-3.30.80-1.02,2.28-1.20,3.30-.40l44.51,34.88c1.02.80,1.20,2.28.40,3.30-.46.59-1.16.90-1.85.90Z" 
            fill="#848125"
          />
          
          {/* Decorative Element - Left Middle */}
          <Path 
            d="M86.56,34.78c-.75,0-1.49-.36-1.95-1.03L64.16,3.68c-.73-1.07-.45-2.54.62-3.27,1.08-.73,2.54-.45,3.27.62l20.45,30.07c.73,1.07.45,2.54-.62,3.27-.41.27-.87.41-1.32.41Z" 
            fill="#848125"
          />
          
          {/* Decorative Element - Left Bottom */}
          <Path 
            d="M39.64,104.55c-.24,0-.48-.04-.72-.11L1.63,92.41c-1.24-.40-1.92-1.73-1.52-2.96.40-1.24,1.72-1.92,2.96-1.52l37.29,12.03c1.24.40,1.92,1.73,1.52,2.96-.32,1-1.25,1.63-2.24,1.63Z" 
            fill="#848125"
          />
          
          {/* Decorative Element - Right Top */}
          <Path 
            d="M317.52,103.35c-.91,0-1.78-.53-2.16-1.43-.51-1.19.04-2.58,1.24-3.09l33.68-14.44c1.19-.51,2.58.04,3.09,1.24.51,1.20-.04,2.58-1.23,3.09l-33.68,14.44c-.30.13-.62.19-.93.19Z" 
            fill="#848125"
          />
          
          {/* Decorative Element - Right Bottom */}
          <Path 
            d="M325.93,139.43c-1.14,0-2.15-.83-2.32-2-.19-1.29.69-2.49,1.97-2.68l55.33-8.42c1.28-.19,2.48.69,2.68,1.97.19,1.28-.69,2.49-1.97,2.68l-55.33,8.42c-.12.02-.24.03-.36.03Z" 
            fill="#848125"
          />
          
          {/* Left Eye Detail */}
          <AnimatedG animatedProps={leftEyeAnimatedProps}>
            <Circle cx="123.71" cy="171.18" r="18.43" fill="#5e041c" />
            <Path 
              d="M135.74,166.47c0-2.71-2.20-4.91-4.91-4.91s-4.91,2.20-4.91,4.91,2.20,4.91,4.91,4.91,4.91-2.20,4.91-4.91Z" 
              fill="#fff"
            />
            <Path 
              d="M114.22,172.83c-1.50-3.30-3.71-5.51-4.95-4.95-1.24.56-1.02,3.69.47,6.98,1.50,3.30,3.71,5.51,4.95,4.95,1.24-.56,1.02-3.69-.47-6.98Z" 
              fill="#fff"
            />
          </AnimatedG>
          
          {/* Right Eye Detail */}
          <AnimatedG animatedProps={rightEyeAnimatedProps}>
            <Circle cx="231.21" cy="171.19" r="18.43" fill="#5e041c" />
            <Path 
              d="M243.25,166.47c0-2.71-2.20-4.91-4.91-4.91s-4.92,2.20-4.92,4.91,2.20,4.91,4.92,4.91,4.91-2.20,4.91-4.91Z" 
              fill="#fff"
            />
            <Path 
              d="M221.73,172.83c-1.50-3.30-3.71-5.51-4.95-4.95-1.24.56-1.02,3.69.47,6.98,1.50,3.30,3.71,5.51,4.95,4.95,1.24-.56,1.02-3.69-.47-6.98Z" 
              fill="#fff"
            />
          </AnimatedG>
        </G>
      </Svg>
    </MascotWrapper>
  );
}